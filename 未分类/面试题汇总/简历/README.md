### 舟山物联网平台项目支撑

**项目描述**

展示舟山市所有接入 OneNET 平台的设备信息

**技术难点 1：如何展示上万台设备信息**

最初方案：服务端一次性返回所有数据，数据量太大，HTTP 请求时间过长，页面渲染卡顿

解决方案 1：服务端简化返回的数据，减少数据量大小，但页面一次性渲染上万条数据依然卡顿

解决方案 2：在方案 1 的基础上，采用点聚合的方式展示这些设备

**技术难点 2：地图缩放卡顿**

因为设备点是以 svg 的形式在 leaflet 中进行展示，每次地图缩放的时候，其实会重新计算设备点的位置，并重新渲染这些设备点，设备点数量过多时，dom 操作也会变得更频繁。解决方案是：采用 cavas 的去渲染这些数据点。

</br>
</br>

### 雄安物联网新区项目支撑

**项目描述**

展示雄安市所有接入 OneNET 平台的设备信息，网页主体展示 3D 项目，View 则悬浮在 3D 项目之上展示统计类型的数据

**技术难点 1：如何与 3D 项目合作**

在 View 中以 iframe 的形式嵌入 3D 项目，通过 postmessage 与 3D 页面通信（点击 3D 模型展示 2D 弹窗...），然后通过 z-index 去控制元素展示层级

</br>
</br>

### 统一用户体系

**需求描述**

由于 View 起步时没有任何产品经理的介入，技术架构的设计时就没有考虑到会作为 OneNET 的一款应用去推广，于是就拥有一套独立的用户体系。但是后期产品规划又要求 View 需要和 OneNET 平台的用户统一，就需要解决统一用户体系这个问题

**View 的登录逻辑**

jwt

**技术难点 1：如何实现用户体系的统一？**

1. 方案一：直接抹掉 View 的用户体系，使用 OneNET 平台的用户体系

    - View 已基本成型，登录逻辑，用户逻辑都需要变动，改动量过大
    - 如果 View 进行私有化部署，则必须依赖于主站的用户体系，耦合性过大

2. 方案二：将主站的用户与 View 的用户进行一一映射

    - 当用户通过主站登录进入 view 时，会默认在 view 中创建一个用户，并通过 detail 字段保存主站用户信息
    - 当用户直接进入 view 时，会根据

新增一个 detail 字段用于保存主站的用户信息，其中将主站的 uid 与 view 用户体系的 uid 进行映射

</br>
</br>

### 用户权限

**需求描述**

分为基础班、企业版、专业版三种权限，对项目数量，部分功能使用进行限制

**技术难点 1：如何实现权限限制？**

1. 由于 view 拥有独立的用户体系，因此

1. 服务端返回用户的权限等级，然后将用户的权限信息保存在 vuex 中，前端通过 JSON 数据结构去维护用户的权限

1. 切记不能将用户敏感信息保存在本地

**技术难点 2：如何实现权限自动刷新？**

前端跟 node 端使用 websocket 建立双向通信，node 端提供一个接口给计费侧，当用户购买完 view 后，直接调用
