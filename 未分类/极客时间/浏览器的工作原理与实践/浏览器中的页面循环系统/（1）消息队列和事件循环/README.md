# 消息队列和事件循环：页面是怎么“活”起来的？

每个渲染进程只有一个主线程，但要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript 任务以及各种输入事件。因此就需要一个系统来统筹调度这些任务，这个**统筹调度系统就是消息队列和事件循环系统**

</br>

### 消息队列和循环机制

1. 消息队列是一种数据结构，可以存放要执行的任务。它符合队列“先进先出”的特点，也就是说要添加任务的话，添加到队列的尾部；要取出任务的话，从队列头部去取

2. 不断循环该消息队列，从中取出任务来执行

</br>
</br>

### 渲染进程如何处理其他进程发送过来的任务

例如：网络进程将请求的数据包给渲染进程，浏览器进程将响应的用户事件发送给渲染进程，渲染进程专门**有一个 IO 线程用来接收其他进程传进来的消息**，接收到消息之后，会将这些消息组装成任务**发送给渲染主线程**。

</br>
</br>

### 如何安全退出

页面主线程会设置一个退出标志的变量，在每次执行完一个任务时，判断是否有设置退出标志，如果设置了，那么就直接中断当前的所有任务，退出线程

</br>
</br>

### 宏任务和微任务队列

为了处理更高优先级的任务，我们把消息队列中的任务称为宏任务，但每个宏任务中都包含了一个微任务队列。等宏任务中的主要功能都直接完成之后，这时候，渲染引擎并不着急去执行下一个宏任务，而是执行当前宏任务中的微任务

</br>
</br>
