# HTTP/2：如何提升网络速度？

</br>

### HTTP/1.1 的主要问题

对**带宽的利用率却并不理想**，带宽是指每秒最大能发送或者接收的字节数。我们把每秒能发送的最大字节数称为上行带宽，每秒能够接收的最大字节数称为下行带宽，主要原因如下：

1. TCP 的慢启动（避免发送超过网络承载能力的数据，造成网络拥塞），一旦一个 TCP 连接建立之后，就进入了发送数据状态，刚开始 TCP 协议会采用一个非常慢的速度去发送数据，然后慢慢加快发送数据的速度，直到发送数据的速度达到一个理想状态

2. 同时开启了多条 TCP 连接，那么这些连接会竞争固定的带宽

3. 队头阻塞的问题：虽然能共用一个 TCP 管道，但是在一个管道中同一时刻只能处理一个请求，在当前的请求没有结束之前，其他的请求只能处于阻塞状态。在阻塞等待的过程中，带宽、CPU 都被白白浪费了

</br>
</br>

### HTTP/2 如何优化带宽问题

1. 一个域名只使用一个 TCP 长连接（解决 TCP 的慢启动）

2. 多路复用机制（解决对头拥塞）

</br>
</br>

### 多路复用机制

![image](./img/http2.png)

HTTP/2 引入二进制分帧层，就实现了 HTTP 的多路复用技术：

1. 浏览器准备好请求数据，包括了请求行、请求头、请求体等信息

2. 这些数据经过二进制分帧层处理之后，会被转换为一个个**带有请求 ID 编号的帧**，通过协议栈将这些帧发送给服务器

3. 服务器接收到所有帧之后，会将所有相同 ID 的帧合并为一条完整的请求信息

4. 同理，二进制分帧层会将这些响应数据转换为一个个带有请求 ID 编号的帧，经过协议栈发送给浏览器

5. 浏览器接收到响应帧之后，会根据 ID 编号将帧的数据提交给对应的请求

</br>
</br>

### 其他特性

1. 设置请求的优先级，可以优先请求 HTML/CSS/JavaScript 等关键资源

2. 服务器推送，访问 html 资源时，提前将相关的 CSS/JavaScript 等资源推送给浏览器

3. 头部压缩，请求头和响应头进行了压缩

</br>
</br>
