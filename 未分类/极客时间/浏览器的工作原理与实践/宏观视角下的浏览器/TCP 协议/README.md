# TCP 协议：如何保证页面文件能被完整送达浏览器？

</br>

### 一个数据包的“旅程”

互联网中的数据是通过数据包来传输的。如果发送的数据很大，那么该数据就会被拆分为很多小数据包来传输（例如：音频、视频）

</br>

**IP：负责把数据包送达目的主机**

数据包要在互联网上进行传输，就要符合 IP 标准。访问任何网站时，实际上是通过电脑的 IP 地址信息把数据包发送给指定的电脑

</br>

**UDP：负责把数据包送达应用程序**

电脑收到数据包后，UDP 通过端口号把数据包分发给正确的程序。他的传输速度很快，只管将数据包分发给目标程序即可，虽然 UDP 传输速度却非常快，但是不能保证数据可靠性，适用于直播视频

1. 数据包在传输过程中容易丢失

2. 当大文件被拆分成很多小的数据包来传输时，这些小的数据包会经过不同的路由，并在不同的时间到达接收端，而 UDP 协议并不知道如何组装还原这些数据包

</br>

**TCP：负责把数据完整地送达应用程序。**

TCP（Transmission Control Protocol，传输控制协议）是一种**面向连接的、可靠的、基于字节流**的传输层通信协议，相比于 UDP 协议，具有如下优势：

1. 对于数据包丢失的情况，TCP 提供重传机制

2. TCP 引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件。

一个完整的 TCP 连接的生命周期包括**建立连接**、**传输数据**和**断开连接**三个阶段：

1. 建立连接（三次握手）：明确客户端和服务端的收、发能力是正常的

    - 第一次：客户端发包给服务端，服务端判断客户端是否具有发送包的能力

    - 第二次：服务端发包给客户端，客户端判断服务端是否具有发送包、接受包的能力

    - 第三次：客户端再次发包给服务端，服务端判断客户端是否具有接受包的能力

2. 数据传输：接收端需要对每个数据包进行确认操作

    - 如果没有在规定时间内得到数据，就会触发重传机制

    - 如果在传输过程中会被拆分成很多小的数据包，接收端会按照 TCP 头中的序号为其排序

3. 断开连接（四次挥手）：服务端收到断开的信号时，应立即做出响应，避免客户端不知是否发送成功，然后再多次发送断开的信号；此外，如果这时候某一方并不想断开连接的话，在第三次挥手的时候可以做出适当的调整

    - 第一次：客户端发送 ACK 确认断开连接的信号

    - 第二次：服务器收到后，立即响应一个 ACK 确认信号表示收到了信息

    - 第三次：服务器再次发送一个 FIN，告诉客户端已经成功断开

    - 第四次：客户端收到了 FIN，再次发送一个 ACK 告诉服务端已经收到关闭连接的消息

</br>
</br>
</br>
</br>
