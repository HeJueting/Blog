# Chrome 架构：仅仅打开了 1 个页面，为什么有 4 个进程？

</br>

### chrome、Chromium、V8 三者的关系

1. V8 是一个由 Google 研发的开源 JavaScript 引擎

2. Chromium 是一个由 Google 主导开发的开源网页浏览器（基于 V8 引擎）

3. Chrome 是基于 Chromium 二次开发的浏览器

</br>
</br>

### 进程和线程

</br>

**什么是进程？**

启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程

</br>

**进程和线程之间的关系特点**

1. 线程是不能单独存在的，它是由进程来启动和管理的

2. 进程中的任意一线程执行出错，都会导致整个进程的崩溃

3. 线程之间共享进程中的数据

4. 当一个进程关闭之后，操作系统会回收进程所占用的内存

5. 进程之间的内容相互隔离，互不影响（可使用进程间通信（IPC）的机制进行通信）

</br>
</br>

### 单进程浏览器时代

单进程浏览器是指浏览器的所有功能模块（网络、插件、JavaScript 运行环境、渲染引擎和页面等）都是运行在同一个进程里

1. 不稳定：任意功能模块的崩溃都会导致浏览器的崩溃

2. 不流畅：同一时刻，只能运行一个模块，容易阻塞

3. 不安全：恶意插件、页面脚本的威胁

</br>
</br>

### 多进程浏览器时代

</br>

**架构**

1. 浏览器进程：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能

2. 渲染进程（多个）：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 **JavaScript 引擎 V8 都是运行在该进程中**，默认情况下，**Chrome 会为每个网页（如果 A、B 两个网站协议和域名相同，会共用一个渲染进程）创建一个渲染进程**。出于安全考虑，**渲染进程都是运行在沙箱模式下**

3. GPU 进程：其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页和 Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程

4. 网络进程：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程

5. 插件进程（多个）：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响

</br>

**优点**

1. 进程之间相互隔离的，所以当一个页面或者插件崩溃时，影响到的仅仅是当前的页面进程或者插件进程

2. 使用安全沙箱，即使在渲染进程或者插件进程里面执行了恶意程序，也无法突破沙箱去获取系统权限

</br>

**缺点**

1. 更高的资源占用：因为每个进程都会包含公共基础结构的副本（如 JavaScript 运行环境），这就意味着浏览器会消耗更多的内存资源

2. 更复杂的体系架构：浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求了

</br>
</br>
